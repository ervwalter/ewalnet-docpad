<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <script type="text/javascript">
        // do not remove this hostname restriction unless you also change the API key below...
        if (window.location.hostname == 'www.ewal.net') {
            var analytics=analytics||[];(function(){var e=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group"],t=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var n=0;n<e.length;n++)analytics[e[n]]=t(e[n])})(),analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)};

            // if you clone this app, please change the API key below to your own...
            analytics.load("83mu6lzb7f");
        }
    </script>

    <title>Knockout Samples in CoffeeScript - Ewal.net</title>
    <meta name="author" content="Erv Walter">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/feed.xml" rel="alternate" title="Ewal.net" type="application/atom+xml">
    <link rel="icon" sizes="300x300" href="/icon.png">
    <link rel="icon" sizes="196x196" href="/icon-196.png">
    <link rel="icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon-precomposed" sizes="128x128" href="/icon-128.png">
    <link href="/favicon.png" rel="shortcut icon">

    <style>
        [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
            display: none !important;
        }
    </style>

    <!-- Bootstrap -->
    <link href="/styles/site.css?1419397389559" rel="stylesheet" media="screen">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/scripts/vendor/html5shiv.js"></script>
    <script src="/scripts/vendor/respond.min.js"></script>
    <![endif]-->

    <meta name="generator" content="DocPad v6.69.1" />
    
</head>
<body>

<a href="https://plus.google.com/103974853049200513652?rel=author" class="google googleplus-hidden" title="Google+">Google+</a>

<div class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">// <span class="text-primary">Ewal.net</span></a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <!--<li><a href="/">Blog</a></li>-->
                <li><a href="/archives/">Archives</a></li>
                <li><a href="/projects/">Projects</a></li>
                <li><a href="/games/"><span class="header-if-wide">Board </span>Games</a></li>
                <li class="hidden-xs">
                    <a href="/feed.xml" class="rss"><span class="icon icon-feed"></span></a>
                    <a href="http://twitter.com/ervwalter" class="twitter"><span class="icon icon-twitter"></span></a>
                    <a href="https://github.com/ervwalter" class="github"><span class="icon icon-github"></span></a>
                </li>
            </ul>
            <form class="navbar-form navbar-right hidden-xs" role="search" action="http://google.com/search"
                  method="get">
                <div class="form-group">
                    <input type="search" name="q" class="form-control" placeholder="Search">
                    <input type="hidden" name="q" value="site:www.ewal.net">
                </div>
            </form>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-12 col-md-10">
            <article id="post" class="post">
    <div class="post-date">Oct 4th, 2012</div>
    
    <h1>Knockout Samples in CoffeeScript</h1>
    
    <div class="post-content">
        <p>In my <a href="/2012/09/28/coffeescript-and-knockout-hello-world/">last post</a>, I talked about my initial experiments with using Knockout with CoffeeScript.  In this post, I want to share the results of my conversions of several of the standard Knockout samples.  As someone said in my first post, this stuff isn&#39;t exactly rocket science.  On the other hand, I know I often learn new tech more quickly by looking at other people&#39;s sample code, so I&#39;m putting these here in case someone else might find them useful.</p>
<h2 id="grid-editor">Grid Editor</h2>
<p>The original Knockout sample page can be found <a href="http://knockoutjs.com/examples/gridEditor.html">here</a>.</p>
<p>My conversion of this one is pretty straightforward.  As a general rule with these conversions, my goal was to remain faithful to the original sample javascript both in how it was solving problems and how the view models were organizaed.  At the same time I tried to use native CoffeeScript features where they made sense (e.g. string interpolation in this example, and comprehensions over arrays in the other examples).</p>
<p>A fully functional version of this conversion can be found in <a href="http://jsfiddle.net/ervwalter/4CLRh/">this jsFiddle</a>, but here is the CoffeeScript:</p>
<pre><code class="lang-coffeescript">class GiftModel
    constructor: (gifts) -&gt;
        @gifts = ko.observableArray gifts

        @addGift = =&gt;
            @gifts.push
                name: &quot;&quot;
                price: &quot;&quot;

        @removeGift = (gift) =&gt;
            @gifts.remove gift

        @save = (form) =&gt;
            alert &quot;Could now transmit to server: #{ko.utils.stringifyJson @gifts}&quot;

$ -&gt;
    viewModel = new GiftModel(
        [
            { name: &quot;Tall Hat&quot;, price: &quot;39.95&quot; }
            { name: &quot;Long Cloak&quot;, price: &quot;120.00&quot;}
        ])
    ko.applyBindings viewModel
    $(&quot;form&quot;).validate submitHandler: viewModel.save
</code></pre>
<h2 id="contacts-editor">Contacts Editor</h2>
<p>The original Knockout sample page can be found <a href="http://knockoutjs.com/examples/contactsEditor.html">here</a>.</p>
<p>This conversion uses a couple more features of CoffeeScript including the use of comprehensions in place of <code>ko.utils.arrayMap()</code> and <code>$.each()</code>.</p>
<p>A fully functional version of my conversion can be found in <a href="http://jsfiddle.net/ervwalter/Rj3pk/">this jsFiddle</a>.  Here is the CoffeeScript:</p>
<pre><code class="lang-coffeescript">initialData = [
    { firstName: &quot;Danny&quot;, lastName: &quot;LaRusso&quot;, phones: [
        { type: &quot;Mobile&quot;, number: &quot;(555) 121-2121&quot; },
        { type: &quot;Home&quot;, number: &quot;(555) 123-4567&quot;}]
    },
    { firstName: &quot;Sensei&quot;, lastName: &quot;Miyagi&quot;, phones: [
        { type: &quot;Mobile&quot;, number: &quot;(555) 444-2222&quot; },
        { type: &quot;Home&quot;, number: &quot;(555) 999-1212&quot;}]
    }
]

class ContactsModel
    constructor: (contacts) -&gt;
        @contacts = ko.observableArray({
                firstName: contact.firstName
                lastName: contact.lastName
                phones: ko.observableArray(contact.phones)
            } for contact in contacts)

        @addContact = =&gt;
            @contacts.push
                firstName: &quot;&quot;
                lastName: &quot;&quot;
                phones: ko.observableArray()

        @removeContact = (contact) =&gt;
            @contacts.remove(contact)

        @addPhone = (contact) =&gt;
            contact.phones.push
                type: &quot;&quot;
                number: &quot;&quot;

        @removePhone = (phone) =&gt;
            contact.phones.remove phone for contact in @contacts()

        @save = =&gt;
            @lastSavedJson JSON.stringify(ko.toJS(@contacts), null, 2)

        @lastSavedJson = ko.observable &quot;&quot;

$ -&gt;
    ko.applyBindings(new ContactsModel(initialData))
</code></pre>
<h2 id="shopping-cart-editor">Shopping Cart Editor</h2>
<p>The original Knockout sample page can be found <a href="http://knockoutjs.com/examples/cartEditor.html">here</a>.</p>
<p>This one is similar to the last two, but includes a second class to hold represent individual items in the shopping cart.</p>
<p>A fully functional version of my conversion can be found in <a href="http://jsfiddle.net/ervwalter/qyDr2/">this jsFiddle</a>, and here is the CoffeeScript:</p>
<pre><code class="lang-coffeescript">window.formatCurrency = (value) -&gt;
    &quot;$&quot; + value.toFixed(2)

class CartLine
    constructor: -&gt;
        @category = ko.observable()
        @product = ko.observable()
        @quantity = ko.observable 1
        @subtotal = ko.computed =&gt;
            if @product() then @product().price * parseInt(&quot;0&quot; + @quantity()) else 0

        @category.subscribe =&gt;
            @product undefined

class Cart
    constructor: -&gt;
        @lines = ko.observableArray [new CartLine()]

        @grandTotal = ko.computed =&gt;
            total = 0
            total += line.subtotal() for line in @lines()
            total

        @addLine = =&gt;
            @lines.push new CartLine()

        @removeLine = (line) =&gt;
            @lines.remove line

        @save = =&gt;
            dataToSave = ({
                productName: line.product().name
                quantity: line.quantity()
            } for line in @lines() when line.product())
            alert &quot;Could now send this to server: #{JSON.stringify dataToSave}&quot;

$ -&gt;
    ko.applyBindings new Cart()
</code></pre>
<h2 id="twitter-client">Twitter Client</h2>
<p>And last but not least, the original version of the most complex Knockout sample page can be found <a href="http://knockoutjs.com/examples/twitter.html">here</a>.</p>
<p>This one exercises a few more knockout features, but was relatively easy to convert using the same basic CoffeeScript patterns I used in the other samples.</p>
<p>A fully functional version of this conversion can be found in <a href="http://jsfiddle.net/ervwalter/95UBd/">this jsFiddle</a>, and here is the CoffeeScript:</p>
<pre><code class="lang-coffeescript">savedLists = [
    { name: &quot;Celebrities&quot;, userNames: [&#39;JohnCleese&#39;, &#39;MCHammer&#39;, &#39;StephenFry&#39;, &#39;algore&#39;, &#39;StevenSanderson&#39;]}
    { name: &quot;Microsoft people&quot;, userNames: [&#39;BillGates&#39;, &#39;shanselman&#39;, &#39;ScottGu&#39;]}
    { name: &quot;Tech pundits&quot;, userNames: [&#39;Scobleizer&#39;, &#39;LeoLaporte&#39;, &#39;techcrunch&#39;, &#39;BoingBoing&#39;, &#39;timoreilly&#39;, &#39;codinghorror&#39;]}
]

class TwitterListModel
    constructor: (lists, selectedList) -&gt;

        @savedLists = ko.observableArray lists
        @editingList = name: ko.observable(selectedList), userNames: ko.observableArray()
        @userNameToAdd = ko.observable &quot;&quot;
        @currentTweets = ko.observableArray []

        @findSavedList = (name) -&gt;
            lists = @savedLists()
            ko.utils.arrayFirst lists, (list) -&gt;
                list.name == name

        @hasUnsavedChanges = ko.computed =&gt;
            if not @editingList.name()
                @editingList.userNames().length &gt; 0
            else
                savedData = @findSavedList(@editingList.name()).userNames
                editingData = @editingList.userNames()
                savedData.join(&quot;|&quot;) != editingData.join(&quot;|&quot;)

        @userNameToAddIsValid = ko.computed =&gt;
            (@userNameToAdd() == &quot;&quot;) || (@userNameToAdd().match(/^\s*[a-zA-Z0-9_]{1,15}\s*$/) != null)

        @canAddUserName = ko.computed =&gt;
            @userNameToAddIsValid &amp;&amp; @userNameToAdd != &quot;&quot;

        @addUser = =&gt;
            if @userNameToAdd() &amp;&amp; @userNameToAddIsValid()
                @editingList.userNames.push @userNameToAdd()
                @userNameToAdd &quot;&quot;

        @removeUser = (userName) =&gt;
            @editingList.userNames.remove userName

        @saveChanges = =&gt;
            saveAs = prompt &quot;Save as&quot;, @editingList.name()
            if saveAs
                dataToSave = @editingList.userNames()[..]
                existingSavedList = @findSavedList(saveAs)
                if (existingSavedList)
                    existingSavedList.userNames = dataToSave
                else
                    @savedLists.push { name: saveAs, userNames: dataToSave }
                @editingList.name(saveAs)

        @deleteList = =&gt;
            nameToDelete @editingList.name()
            savedListsExceptOneToDelete = (list for list in @savedLists() when list.name != nameToDelete)
            @editingList.name(if savedListsExceptOneToDelete.length == 0 then null else savedListsExceptOneToDelete[0].name)
            @savedLists savedListsExceptOneToDelete

        ko.computed =&gt;
            savedList = @findSavedList @editingList.name()
            if savedList
                userNamesCopy = savedList.userNames[..]
                @editingList.userNames userNamesCopy
            else
                @editingList.userNames []

        ko.computed =&gt;
            twitterApi.getTweetsForUsers @editingList.userNames(), @currentTweets

$ -&gt;
    ko.applyBindings new TwitterListModel(savedLists, &quot;Tech pundits&quot;)
    $(&quot;.loadingIndicator&quot;).ajaxStart(-&gt; $(@).fadeIn()).ajaxComplete(-&gt; $(@).fadeOut())
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>In all of these conversions, I feel like the resulting CoffeeScript is easier to read and easier to maintain than the original JavaScript versions.  I will definitely be writing in CoffeeScript for my next Knockout-using project.</p>

    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/knockout/'>Knockout</a>, <a href='/tags/coffeescript/'>CoffeeScript</a>
    </div>
    
</article>
            <div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<script type="text/javascript">
    var disqus_shortname = 'ewalnet';
    var disqus_url = 'http://www.ewal.net/2012/10/04/knockout-samples-in-coffeescript/';
    var disqus_identifier = disqus_url;
    var disqus_title = 'Knockout Samples in CoffeeScript';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

            <div id="me">
    <p>
        <img src="http://en.gravatar.com/avatar/5fcc0f8df1923f433513b0f731c99402?s=100" alt="Erv Walter" />
        I'm <b>Erv Walter</b>, a software developer, a computer geek, and a board game addict living in Sun Prairie, Wisconsin.  My interests include Azure, ASP.NET, Node.js, AngularJS, Knockout, and web development in general. And I'm a sucker for any kind of gadget.
    </p>
    <p>
        <a href="http://twitter.com/ervwalter">@ErvWalter</a> &#8226;
        <a href="https://github.com/ervwalter">GitHub</a> &#8226;
        <a href="mailto:erv@ewal.net">Email Me</a>
    </p>
</div>

        </div>
    </div>
</div>
<div class="container">
    <div class="navbar navbar-footer">
        <p class="navbar-center navbar-text">Copyright &copy; 2011-2013 Erv Walter</p>
    </div>
</div>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="/scripts/vendor/highlight.pack.js?1419397389559"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.6.3/coffee-script.min.js"></script>
<script src="/scripts/site.js?1419397389559"></script>



<script type="text/javascript">
	var $buoop = {
		url: 'http://whatbrowser.org/',
        reminder: 0,
		newwindow: false,
		'text': 'You are using an outdated browser (%s). <a%s>More information &#187;</a>',
		'text_af': 'Jy gebruik \'n verouderde webblaaier (%s). <a%s>Meer inligting &#187;</a>',
		'text_cs': 'Používáte zastaralý prohlížeč (%s). <a%s>Více informací &#187;</a>',
		'text_da': 'Du bruger en ældre browser (%s). <a%s>Mere information &#187;</a>',
		'text_de': 'Sie benutzen einen veralteten Browser (%s). <a%s>Mehr Informationen &#187;</a>',
		'text_el': 'Χρησιμοποιείτε ένα ξεπερασμένο πρόγραμμα περιήγησης. <a%s>Περισσότερες πληροφορίες &#187;</a>',
		'text_es': 'Su navegador está obsoleto (%s). <a%s>M&aacute;s informaci&oacute;n &#187;</a>',
		'text_fi': 'Käytät vanhentunutta selainta (%s). <a%s>Lisää tietoa &#187;</a>',
		'text_fr': 'Votre navigateur n\'est pas à jour (%s). <a%s>Plus d\'information &#187;</a>',
		'text_hu': 'A böngészője elavult (%s). <a%s>További információ &#187;</a>',
		'text_id': 'Anda menggunakan web browser versi lama (%s). <a%s>Informasi selengkapnya &#187;</a>',
		'text_is': 'Þú ert að nota úreltan vafra (%s). <a%s>Nánari upplýsingar &#187;</a>',
		'text_it': 'Stai usando un browser datato (%s). <a%s>Ulteriori informazioni &#187;</a>',
		'text_nl': 'U gebruikt op dit moment een verouderde webbrowser (%s). <a%s>Meer informatie &#187;</a>',
		'text_pl': 'Używasz przestarzałej przeglądarki (%s). <a%s>Więcej informacji &#187;</a>',
		'text_pt': 'Você está usando um navegador antigo (%s). <a%s>Mais informações &#187;</a>',
		'text_ro': 'Browserul dumneavoastră este depăşit (%s). <a%s>Mai multe informații &#187;</a>',
		'text_ru': 'Вы используете устаревший браузер (%s). <a%s>Подробнее &#187;</a>',
		'text_sk': 'Používate zastaralý prehliadač (%s). <a%s>Viac informácií &#187;</a>',
		'text_sr': 'Vi koristite zastarelu verziju browsera (%s). <a%s>Vi&#353;e informacija &#187;</a>',
		'text_sv': 'Du använder en gammal webbläsare (%s). <a%s>Mer information &#187;</a>',
		'text_tr': 'Çok eski bir tarayıcı kullanıyorsunuz (%s). <a%s>Daha fazla bilgi &#187;</a>',
		'text_vi': 'Trình duyệt bạn dùng đã lỗi thời rồi (%s). <a%s>Thêm thông tin &#187;</a>'
	};
	$buoop.ol = window.onload;
	window.onload=function(){
		try {if ($buoop.ol) $buoop.ol();}catch (e) {}
		var e = document.createElement("script");
		e.setAttribute("type", "text/javascript");
		e.setAttribute("src", "//browser-update.org/update.js");
		document.body.appendChild(e);
	}
</script>

</body>
</html>