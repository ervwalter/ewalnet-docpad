<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <script type="text/javascript">
        // do not remove this hostname restriction unless you also change the API key below...
        if (window.location.hostname == 'www.ewal.net') {
            var analytics=analytics||[];(function(){var e=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group"],t=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var n=0;n<e.length;n++)analytics[e[n]]=t(e[n])})(),analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)};

            // if you clone this app, please change the API key below to your own...
            analytics.load("83mu6lzb7f");
        }
    </script>

    <title>Atom Feeds With DocPad - Ewal.net</title>
    <meta name="author" content="Erv Walter">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/feed.xml" rel="alternate" title="Ewal.net" type="application/atom+xml">
    <link rel="icon" sizes="300x300" href="/icon.png">
    <link rel="icon" sizes="196x196" href="/icon-196.png">
    <link rel="icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon-precomposed" sizes="128x128" href="/icon-128.png">
    <link href="/favicon.png" rel="shortcut icon">

    <style>
        [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
            display: none !important;
        }
    </style>

    <!-- Bootstrap -->
    <link href="/styles/site.css?1419397389559" rel="stylesheet" media="screen">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/scripts/vendor/html5shiv.js"></script>
    <script src="/scripts/vendor/respond.min.js"></script>
    <![endif]-->

    <meta name="generator" content="DocPad v6.69.1" />
    
</head>
<body>

<a href="https://plus.google.com/103974853049200513652?rel=author" class="google googleplus-hidden" title="Google+">Google+</a>

<div class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">// <span class="text-primary">Ewal.net</span></a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <!--<li><a href="/">Blog</a></li>-->
                <li><a href="/archives/">Archives</a></li>
                <li><a href="/projects/">Projects</a></li>
                <li><a href="/games/"><span class="header-if-wide">Board </span>Games</a></li>
                <li class="hidden-xs">
                    <a href="/feed.xml" class="rss"><span class="icon icon-feed"></span></a>
                    <a href="http://twitter.com/ervwalter" class="twitter"><span class="icon icon-twitter"></span></a>
                    <a href="https://github.com/ervwalter" class="github"><span class="icon icon-github"></span></a>
                </li>
            </ul>
            <form class="navbar-form navbar-right hidden-xs" role="search" action="http://google.com/search"
                  method="get">
                <div class="form-group">
                    <input type="search" name="q" class="form-control" placeholder="Search">
                    <input type="hidden" name="q" value="site:www.ewal.net">
                </div>
            </form>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-12 col-md-10">
            <article id="post" class="post">
    <div class="post-date">Oct 9th, 2013</div>
    
    <h1>Atom Feeds With DocPad</h1>
    
    <div class="post-content">
        <p>If you are generating a blog or a blog-like site with DocPad, you&#39;ll probably want to create a atom or rss feed for the site.  Doing so is reasonably straightforward, but there is one little trick to be aware of.  The trick is that you need to convert any relative URLs in your blog content to absolute URLs.</p>
<p>First, start with a <code>feed.xml.eco</code> document that looks like this:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;
    &lt;title&gt;&lt;%= @site.title %&gt;&lt;/title&gt;
    &lt;link href=&quot;&lt;%= @site.url %&gt;/feed.xml&quot; rel=&quot;self&quot;/&gt;
    &lt;link href=&quot;&lt;%= @site.url %&gt;&quot;/&gt;
    &lt;updated&gt;&lt;%= @site.date.toISOString() %&gt;&lt;/updated&gt;
    &lt;id&gt;&lt;%= @site.url %&gt;&lt;/id&gt;
    &lt;author&gt;
        &lt;name&gt;&lt;%= @site.author %&gt;&lt;/name&gt;
        &lt;email&gt;&lt;%= @site.email %&gt;&lt;/email&gt;
    &lt;/author&gt;

    &lt;% for document in @getCollection(&#39;posts&#39;).toJSON()[0..9]: %&gt;
    &lt;entry&gt;
        &lt;title&gt;&lt;%= document.title %&gt;&lt;/title&gt;
        &lt;link href=&quot;&lt;%= @site.url %&gt;&lt;%= document.url %&gt;&quot;/&gt;
        &lt;updated&gt;&lt;%= document.date.toISOString() %&gt;&lt;/updated&gt;
        &lt;id&gt;&lt;%= @getIdForDocument(document) %&gt;&lt;/id&gt;
        &lt;content type=&quot;html&quot;&gt;&lt;![CDATA[&lt;%- @fixLinks(document.contentRenderedWithoutLayouts) %&gt;]]&gt;&lt;/content&gt;
    &lt;/entry&gt;
    &lt;% end %&gt;
&lt;/feed&gt;
</code></pre>
<p>You can see that the document is reasonably straightforward.  It generates a basic atom <code>feed</code> element, fills in the required elements using values from your docpad configuration.  Then it creates an <code>entry</code> for each of the 10 most recent blog posts.  It fills in each <code>entry</code> element with details about each post.</p>
<p>Notice the <code>@fixLinks()</code> call inside the <code>content</code> element.  This is the trick I mentioned.  This function parses the HTML content of each blog post looking for URLs in <code>&lt;a&gt;</code> and <code>&lt;img&gt;</code> tags that don&#39;t include a scheme (e.g. http://) and hostname in them and adds the site&#39;s base url (e.g. <a href="http://www.ewal.net">http://www.ewal.net</a>).  For example this html in a blog post:</p>
<pre><code>&lt;a href=&quot;/2013/10/08/blogging-with-docpad/&quot;&gt;My last post&lt;/a&gt;
&lt;img src=&quot;/stuff/forsalebyowner.png&quot; /&gt;
</code></pre><p>becomes:</p>
<pre><code>&lt;a href=&quot;http://www.ewal.net/2013/10/08/blogging-with-docpad/&quot;&gt;My last post&lt;/a&gt;
&lt;img src=&quot;http://www.ewal.net/stuff/forsalebyowner.png&quot; /&gt;
</code></pre><p>This is very important if you include links in your blog posts that don&#39;t always include your domain&#39;s hostname.  Without this fix, people will see broken images and your internal site links won&#39;t work if they read you blog in a newsreader.</p>
<p>The <code>@getIdForDocument()</code> call just creates an appropriate unique Id for each post using <a href="http://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id">Mark Pilgrim&#39;s guidelines</a>.</p>
<p>The code for <code>fixLinks</code> and <code>getIdForDocument</code> lives in <code>docpad.coffee</code> as functions added to templateData.  They look like this:</p>
<pre><code class="lang-coffeescript">docpadConfig = {
    templateData:

        getIdForDocument: (document) -&gt;
            hostname = url.parse(@site.url).hostname
            date = document.date.toISOString().split(&#39;T&#39;)[0]
            path = document.url
            &quot;tag:#{hostname},#{date},#{path}&quot;

        fixLinks: (content) -&gt;
            baseUrl = @site.url
            regex = /^(http|https|ftp|mailto):/

            $ = cheerio.load(content)
            $(&#39;img&#39;).each -&gt;
                $img = $(@)
                src = $img.attr(&#39;src&#39;)
                $img.attr(&#39;src&#39;, baseUrl + src) unless regex.test(src)
            $(&#39;a&#39;).each -&gt;
                $a = $(@)
                href = $a.attr(&#39;href&#39;)
                $a.attr(&#39;href&#39;, baseUrl + href) unless regex.test(href)
            $.html()
}
</code></pre>
<p>These two functions use a couple node modules&mdash;one named <a href="http://matthewmueller.github.io/cheerio/">cheerio</a> to parse the HTML using a jQuery-like API and the standard <code>url</code> module from node.js.  Add references to them at the top of docpad.coffee (after you <code>npm install --save cheerio</code> of course):</p>
<pre><code>cheerio = require(&#39;cheerio&#39;)
url = require(&#39;url&#39;)
</code></pre><p>You can see this code &quot;in context&quot; in <a href="https://github.com/ervwalter/ewalnet-docpad/blob/master/docpad.coffee">docpad.coffee</a> and <a href="https://github.com/ervwalter/ewalnet-docpad/blob/master/src/documents/feed.xml.eco">feed.xml.eco</a> from my blog&#39;s source code.</p>
<p>That&#39;s basically all there is too it. My site generates an atom feed, but you could just as easily use this technique to create an rss feed instead of or in addition to an atom feed if you prefer.</p>

    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/docpad/'>DocPad</a>
    </div>
    
</article>
            <div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<script type="text/javascript">
    var disqus_shortname = 'ewalnet';
    var disqus_url = 'http://www.ewal.net/2013/10/09/atom-feeds-with-docpad/';
    var disqus_identifier = disqus_url;
    var disqus_title = 'Atom Feeds With DocPad';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

            <div id="me">
    <p>
        <img src="http://en.gravatar.com/avatar/5fcc0f8df1923f433513b0f731c99402?s=100" alt="Erv Walter" />
        I'm <b>Erv Walter</b>, a software developer, a computer geek, and a board game addict living in Sun Prairie, Wisconsin.  My interests include Azure, ASP.NET, Node.js, AngularJS, Knockout, and web development in general. And I'm a sucker for any kind of gadget.
    </p>
    <p>
        <a href="http://twitter.com/ervwalter">@ErvWalter</a> &#8226;
        <a href="https://github.com/ervwalter">GitHub</a> &#8226;
        <a href="mailto:erv@ewal.net">Email Me</a>
    </p>
</div>

        </div>
    </div>
</div>
<div class="container">
    <div class="navbar navbar-footer">
        <p class="navbar-center navbar-text">Copyright &copy; 2011-2013 Erv Walter</p>
    </div>
</div>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="/scripts/vendor/highlight.pack.js?1419397389559"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.6.3/coffee-script.min.js"></script>
<script src="/scripts/site.js?1419397389559"></script>



<script type="text/javascript">
	var $buoop = {
		url: 'http://whatbrowser.org/',
        reminder: 0,
		newwindow: false,
		'text': 'You are using an outdated browser (%s). <a%s>More information &#187;</a>',
		'text_af': 'Jy gebruik \'n verouderde webblaaier (%s). <a%s>Meer inligting &#187;</a>',
		'text_cs': 'Používáte zastaralý prohlížeč (%s). <a%s>Více informací &#187;</a>',
		'text_da': 'Du bruger en ældre browser (%s). <a%s>Mere information &#187;</a>',
		'text_de': 'Sie benutzen einen veralteten Browser (%s). <a%s>Mehr Informationen &#187;</a>',
		'text_el': 'Χρησιμοποιείτε ένα ξεπερασμένο πρόγραμμα περιήγησης. <a%s>Περισσότερες πληροφορίες &#187;</a>',
		'text_es': 'Su navegador está obsoleto (%s). <a%s>M&aacute;s informaci&oacute;n &#187;</a>',
		'text_fi': 'Käytät vanhentunutta selainta (%s). <a%s>Lisää tietoa &#187;</a>',
		'text_fr': 'Votre navigateur n\'est pas à jour (%s). <a%s>Plus d\'information &#187;</a>',
		'text_hu': 'A böngészője elavult (%s). <a%s>További információ &#187;</a>',
		'text_id': 'Anda menggunakan web browser versi lama (%s). <a%s>Informasi selengkapnya &#187;</a>',
		'text_is': 'Þú ert að nota úreltan vafra (%s). <a%s>Nánari upplýsingar &#187;</a>',
		'text_it': 'Stai usando un browser datato (%s). <a%s>Ulteriori informazioni &#187;</a>',
		'text_nl': 'U gebruikt op dit moment een verouderde webbrowser (%s). <a%s>Meer informatie &#187;</a>',
		'text_pl': 'Używasz przestarzałej przeglądarki (%s). <a%s>Więcej informacji &#187;</a>',
		'text_pt': 'Você está usando um navegador antigo (%s). <a%s>Mais informações &#187;</a>',
		'text_ro': 'Browserul dumneavoastră este depăşit (%s). <a%s>Mai multe informații &#187;</a>',
		'text_ru': 'Вы используете устаревший браузер (%s). <a%s>Подробнее &#187;</a>',
		'text_sk': 'Používate zastaralý prehliadač (%s). <a%s>Viac informácií &#187;</a>',
		'text_sr': 'Vi koristite zastarelu verziju browsera (%s). <a%s>Vi&#353;e informacija &#187;</a>',
		'text_sv': 'Du använder en gammal webbläsare (%s). <a%s>Mer information &#187;</a>',
		'text_tr': 'Çok eski bir tarayıcı kullanıyorsunuz (%s). <a%s>Daha fazla bilgi &#187;</a>',
		'text_vi': 'Trình duyệt bạn dùng đã lỗi thời rồi (%s). <a%s>Thêm thông tin &#187;</a>'
	};
	$buoop.ol = window.onload;
	window.onload=function(){
		try {if ($buoop.ol) $buoop.ol();}catch (e) {}
		var e = document.createElement("script");
		e.setAttribute("type", "text/javascript");
		e.setAttribute("src", "//browser-update.org/update.js");
		document.body.appendChild(e);
	}
</script>

</body>
</html>