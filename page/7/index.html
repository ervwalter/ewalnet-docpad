<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <script type="text/javascript">
        // do not remove this hostname restriction unless you also change the API key below...
        if (window.location.hostname == 'www.ewal.net') {
            var analytics=analytics||[];(function(){var e=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group"],t=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var n=0;n<e.length;n++)analytics[e[n]]=t(e[n])})(),analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)};

            // if you clone this app, please change the API key below to your own...
            analytics.load("83mu6lzb7f");
        }
    </script>

    <title>Ewal.net</title>
    <meta name="author" content="Erv Walter">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/feed.xml" rel="alternate" title="Ewal.net" type="application/atom+xml">
    <link rel="icon" sizes="300x300" href="/icon.png">
    <link rel="icon" sizes="196x196" href="/icon-196.png">
    <link rel="icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon-precomposed" sizes="128x128" href="/icon-128.png">
    <link href="/favicon.png" rel="shortcut icon">

    <style>
        [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
            display: none !important;
        }
    </style>

    <!-- Bootstrap -->
    <link href="/styles/site.css?1419397389559" rel="stylesheet" media="screen">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/scripts/vendor/html5shiv.js"></script>
    <script src="/scripts/vendor/respond.min.js"></script>
    <![endif]-->

    <meta name="generator" content="DocPad v6.69.1" />
    
</head>
<body>

<a href="https://plus.google.com/103974853049200513652?rel=author" class="google googleplus-hidden" title="Google+">Google+</a>

<div class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">// <span class="text-primary">Ewal.net</span></a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <!--<li><a href="/">Blog</a></li>-->
                <li><a href="/archives/">Archives</a></li>
                <li><a href="/projects/">Projects</a></li>
                <li><a href="/games/"><span class="header-if-wide">Board </span>Games</a></li>
                <li class="hidden-xs">
                    <a href="/feed.xml" class="rss"><span class="icon icon-feed"></span></a>
                    <a href="http://twitter.com/ervwalter" class="twitter"><span class="icon icon-twitter"></span></a>
                    <a href="https://github.com/ervwalter" class="github"><span class="icon icon-github"></span></a>
                </li>
            </ul>
            <form class="navbar-form navbar-right hidden-xs" role="search" action="http://google.com/search"
                  method="get">
                <div class="form-group">
                    <input type="search" name="q" class="form-control" placeholder="Search">
                    <input type="hidden" name="q" value="site:www.ewal.net">
                </div>
            </form>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-12 col-md-10">
            
    <article id="post" class="post">
    <div class="post-date">Sep 8th, 2012</div>
    
    <h1><a href='/2012/09/08/octopress-customizations/'>Octopress Customizations</a></h1>
    
    <div class="post-content">
        <p><em><strong>Note:</strong> The blog you are reading right now is no longer generated by Octopress.  What you will read below is still useful if you&#39;re interested in Octopress, but you should not try to correlate what it talks about with the HTML/JavaScript you&#39;re seeing on the blog today.  They won&#39;t match up exactly.</em></p>
<p>This is a very long post, but I wanted to capture the essence of all of the functional changes I made as part of deploying Octopress (excluding look and feel of the site).  If I ever need this information again, it will be easier for me to read this post instead of sifting through a git commit log.  And maybe something in here will be useful to someone else.</p>
<p>Here are the topics covered in this blog post:</p>
<ul>
<li>Remove /blog/ from URLs</li>
<li>Remove line numbers in the Atom feed</li>
<li>Add categories/tags to posts in the Atom feed</li>
<li>Creating a categories index page</li>
<li>Adding support for Clicky Analytics</li>
<li>Adding support for FancyBox</li>
<li>Changes to the &#39;new_post&#39; Rakefile task</li>
<li>Automatic renaming of post files to have the correct date in them</li>
<li>Setting up Rake-Rewrite</li>
<li>Making the 404 page actually return a 404 status</li>
<li>Notifying Google, Bing, and Ping-o-matic after I make new posts</li>
<li>Deploying to Heroku using an alternative approach</li>
</ul>
<p>You can also see these changes in this <a href="https://github.com/ervwalter/octopress-ewal">GitHub repository</a> if you prefer.</p>
<h2 id="remove-blog-from-urls">Remove /blog/ from URLs</h2>
<p>This one is pretty simple.  I didn&#39;t want /blog/ as a part of any URLs.  There are four changes to make this happen:</p>
<ol>
<li>Change the permalink setting in _config.yml: <code>permalink: /:year/:month/:day/:title/</code></li>
<li>Move ./source/blog/articles/index.html to ./source/articles/index.html (and remove the empty ./source/blog/ folder)</li>
<li>Updated the &quot;Archives&quot; hyperlink in <code>./source/_includes/custom/navigation.html</code></li>
<li>Updated the &quot;Blog Archives&quot; hyperlink in <code>./source/index.html</code></li>
</ol>
<p>Note, I think /blog/ has been removed from URLs by default in the next version of Octopress (2.1), so this may eventually be unnecessary.</p>
<h2 id="remove-line-numbers-in-atom-feed">Remove Line Numbers in Atom Feed</h2>
<p>Code snippets in Octopress are nicely formatted with syntax highlighting when you visit the actual web site.  However, that formatting does not appear when a blog post is viewed in an feed reader like Google Reader because the web site&#39;s CSS is not getting applied. The result isn&#39;t horrible, but one thing that annoyed me was that line numbers still appear but without any padding between the line numbers and the code lines.  I felt the result was actually pretty hard to read.  My solution is to make the line numbers not appear in the Atom version of the post markup.</p>
<p>There are two parts to making this work.  First, I defined a new Liquid filter (in <code>./plugins/custom_filter.rb</code>) that looked for the column of line numbers and removes it.  Note, I originally tried just hiding the column, but Google Reader strips out HTML style attributes for security reasons.</p>
<pre><code class="lang-ruby">module CustomLiquidFilters
  def remove_linenumbers(input)
    input.gsub(/\&lt;td\ class=&quot;gutter&quot;\&gt;.+?\&lt;\/td\&gt;/m, &#39; &#39;)
  end
end

Liquid::Template.register_filter CustomLiquidFilters
</code></pre>
<p>Second, I edited <code>./source/atom.xml</code> and added the new filter.</p>
<pre><code class="lang-xml">&lt;entry&gt;
  ... other elements ...
  &lt;content type=&quot;html&quot;&gt;&lt;![CDATA[{{ post.content | remove_linenumbers | expand_urls: site.url | cdata_escape }}]]&gt;&lt;/content&gt;
&lt;/entry&gt;
</code></pre>
<h2 id="categories-in-the-atom-feed">Categories in the Atom Feed</h2>
<p>I also added post category information to the Atom feed. This is also just a couple lines added to <code>./source/atom.xml</code>.  The tag that is added is normalized so that the scheme + term ends up being the correct URL for that category&#39;s index page.</p>
<pre><code class="lang-xml">&lt;entry&gt;
  ... other elements ...
  {% for category in post.categories %}
  &lt;category scheme=&quot;{{ site.url }}/categories/&quot; term=&quot;{{ category | replace: &#39; &#39;,&#39;-&#39; | downcase }}&quot; /&gt;
  {% endfor %}
&lt;/entry&gt;
</code></pre>
<h2 id="categories-index-page">Categories Index Page</h2>
<p>I added a <a href="/categories/">category list</a> page.  This uses the <a href="https://github.com/alswl/octopress-category-list">category_list.rb plugin</a> by alswl.  For now, I have decided to use a simple unordered list instead of a tag cloud as I think that works better with the small number of categories I have at the moment.</p>
<p>I created a new page at <code>./source/categories/index.html</code> that uses the plugin.</p>
<pre><code class="lang-html">---
layout: page
title: Categories
footer: true
body_id: categories
date: 2012-08-11 23:20
---

&lt;div&gt;
  &lt;ul id=&quot;category-list&quot;&gt;{% category_list counter:true %}&lt;/ul&gt;
&lt;/div&gt;
</code></pre>
<h2 id="clicky-analytics">Clicky Analytics</h2>
<p>I use <a href="http://getclicky.com/66497886">Clicky</a> for analytics on all my web sites.  Enabling it for this one was as easy as adding the asynchronous tracking code to <code>./source/_includes/custom/after_footer.html</code></p>
<pre><code class="lang-html">&lt;script type=&quot;text/javascript&quot;&gt;
var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(66633993);
(function() {
  var s = document.createElement(&#39;script&#39;);
  s.type = &#39;text/javascript&#39;;
  s.async = true;
  s.src = &#39;//static.getclicky.com/js&#39;;
  ( document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0] ).appendChild( s );
})();
&lt;/script&gt;
</code></pre>
<h2 id="fancybox">FancyBox</h2>
<p>I use <a href="http://fancyapps.com/fancybox/">fancyBox</a> with some of my images in blog posts.  The first part of the setup is pretty standard:</p>
<ol>
<li>Add a reference to jquery.fancybox.css in ./source/_includes/custom/head.html</li>
<li>Add a reference to jquery.min.js (if it is not already there) in ./source/_includes/custom/after_footer.html</li>
<li>Add a reference to jquery.fancybox.pack.js in ./source/_includes/custom/after_footer.html</li>
</ol>
<p>To actually create blog posts with images that are enabled for fancybox, I use the Octopress <a href="http://octopress.org/docs/plugins/image-tag/">image tag</a> and include a fancybox css class on images.</p>
<pre><code class="lang-none">{% img fancybox /stuff/currentcost-transmitter1.jpg 120 %}
</code></pre>
<p>That results in an image like this... (click to activate the fancybox light box)</p>
<p><img class="fancybox" src="/stuff/currentcost-transmitter1.jpg" width="120" /></p>
<p>I have a bit of javascript that adjusts the generated markup so that it works with fancybox.  It wraps the <code>&lt;img /&gt;</code> tag with the <code>&lt;a&gt;&lt;/a&gt;</code> tag that fancybox expects.  Any classes on the image tag are moved to the new anchor tag and the caption is copied to the anchor as well.  Also, all of the images in a given post are added to a fancybox gallery.  It&#39;s done per-post so that when viewing the main index of the blog, unrelated images don&#39;t end up getting added to one large gallery.</p>
<pre><code class="lang-js">$(function()) {
  $(&#39;.entry-content&#39;).each(function(i){
    var _i = i;
    $(this).find(&#39;img.fancybox&#39;).each(function(){
      var img = $(this);
      var title = img.attr(&quot;title&quot;);
      var classes = img.attr(&quot;class&quot;);
      img.removeAttr(&quot;class&quot;);
      img.wrap(&#39;&lt;a href=&quot;&#39;+this.src+&#39;&quot; class=&quot;&#39; + classes + &#39;&quot; rel=&quot;gallery&#39;+_i+&#39;&quot; /&gt;&#39;);
      if (title != &quot;&quot;)
      {
        img.parent().attr(&quot;title&quot;, title);
      }
    });
  });
  $(&#39;.fancybox&#39;).fancybox();
});
</code></pre>
<h2 id="new-post-rake-task">New Post Rake Task</h2>
<p>I have modified the new_post rake task in two ways:</p>
<ol>
<li>New posts are created as draft posts (unpublished) by adding &#39;published: false&#39; to the new file (line 17 below)</li>
<li>New posts open in Sublime Text 2 after they are created (line 22 below)</li>
</ol>
<p>Here is the modified new_post rake task (in <code>./Rakefile</code>):</p>
<pre><code class="lang-ruby">desc &quot;Begin a new post in #{source_dir}/#{posts_dir}&quot;
task :new_post, :title do |t, args|
  raise &quot;## You haven&#39;t set anything up yet. First run `rake install` to set up an Octopress theme.&quot; unless File.directory?(source_dir)
  mkdir_p &quot;#{source_dir}/#{posts_dir}&quot;
  args.with_defaults(:title =&gt; &#39;new-post&#39;)
  title = args.title
  filename = &quot;#{source_dir}/#{posts_dir}/#{Time.now.strftime(&#39;%Y-%m-%d&#39;)}-#{title.to_url}.#{new_post_ext}&quot;
  if File.exist?(filename)
    abort(&quot;rake aborted!&quot;) if ask(&quot;#{filename} already exists. Do you want to overwrite?&quot;, [&#39;y&#39;, &#39;n&#39;]) == &#39;n&#39;
  end
  puts &quot;Creating new post: #{filename}&quot;
  open(filename, &#39;w&#39;) do |post|
    post.puts &quot;---&quot;
    post.puts &quot;layout: post&quot;
    post.puts &quot;title: \&quot;#{title.gsub(/&amp;/,&#39;&amp;amp;&#39;)}\&quot;&quot;
    post.puts &quot;date: #{Time.now.strftime(&#39;%Y-%m-%d %H:%M&#39;)}&quot;
    post.puts &quot;published: false&quot;
    post.puts &quot;comments: true&quot;
    post.puts &quot;categories: &quot;
    post.puts &quot;---&quot;
  end
  system &quot;subl \&quot;#{filename}\&quot;&quot;
end
</code></pre>
<h2 id="post-renaming">Post Renaming</h2>
<p>During deployment, I wanted published post files to be renamed using the date contained in the file.  This situation occurs because I often start working on a draft post but don&#39;t get around to finishing it for several days.  When I do finish it, I set the date in the header of the file to be correct and flip the &#39;published&#39; flag to &#39;true&#39;.</p>
<p>The date in the filename doesn&#39;t affect anything with how the site is published, but it&#39;s nice to have the filename match the actual post date.  I accomplished this by creating a new rake task (again, in <code>./Rakefile</code>) to systematically rename any files in <code>./source/_posts</code> which have a filename inconsistent with the date inside the file.  I then call <code>rake rename_posts</code> in my deployment script so that files get fixed every time I deploy.  Note, draft/unpublished files are ignored by this task.</p>
<pre><code class="lang-ruby">desc &quot;Rename files in the posts directory if the filename does not match the post date in the YAML front matter&quot;
task :rename_posts do
  Dir.chdir(&quot;#{source_dir}/#{posts_dir}&quot;) do
    Dir[&#39;*.markdown&#39;].each do |post|
      post_date = &quot;&quot;
      File.open( post ) do |f|
        f.grep( /^date: / ) do |line|
          post_date = line.gsub(/date: /, &quot;&quot;).gsub(/\s.*$/, &quot;&quot;)
          break
        end
      end
      post_title = post.to_s.gsub(/\d{4}-\d{2}-\d{2}/, &quot;&quot;)  # Get the post title from the currently processed post
      new_post_name = post_date + post_title # determing the correct filename
      is_draft = false
      File.open( post ) do |f|
          f.grep( /^published: false/ ) do |line|
            is_draft = true
            break
          end
      end
      if !is_draft &amp;&amp; post != new_post_name     
          puts &quot;renaming #{post} to #{new_post_name}&quot;
          FileUtils.mv(post, new_post_name)
      end
    end
  end
end
</code></pre>
<h2 id="rack-rewrite">Rack::Rewrite</h2>
<p>Ewal.net has had a lots of different content since I first created it back in the 1990s.  And bizarrely, some people still occasionally come to ancient URLs that have long since ceased to exist.</p>
<p>Also, Ewal.net now contains blog posts about <a href="/trendweight/">TrendWeight</a> that used to be hosted on a different blog engine which had a different set of permalinks.</p>
<p>To deal with both issues, I use <a href="https://github.com/jtrupiano/rack-rewrite">Rack-Rewrite</a> as described by Scott Watermasysk in <a href="http://www.scottw.com/octopress-customizations">this blog post</a>.</p>
<p>My rewrite rules (added to <code>./config.ru</code>) handle making sure people looking for old TrendWeight blog posts end up in the right place and that people trying to visit those ancient URLs that seem to most commonly still be used end up some place useful.  In <code>./config.ru</code>:</p>
<pre><code class="lang-ruby">require &#39;rack-rewrite&#39;

# other stuff appears here ...

use Rack::Rewrite do
  r301 %r{^/2012/08/new-feature-1-kg-220462-lb.html}, &#39;http://www.ewal.net/2012/08/20/new-feature-1-kg-equals-2-dot-20462-lb/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2012/07/fitbit-aria-retina-displays-user.html}, &#39;http://www.ewal.net/2012/07/09/fitbit-aria-retina-displays-user-interface-improvements/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2012/04/fitbit-aria-support-coming-soon.html}, &#39;http://www.ewal.net/2012/04/24/fitbit-aria-support-coming-soon/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2012/03/withings-is-having-technical.html}, &#39;http://www.ewal.net/2012/03/24/withings-is-having-technical-difficulties/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2012/01/withings-is-having-technical.html}, &#39;http://www.ewal.net/2012/01/19/withings-is-having-technical-difficulties/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2012/01/missed-day-no-problem-linear.html}, &#39;http://www.ewal.net/2012/01/15/missed-a-day-no-problem/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2011/12/upcoming-maintenance.html}, &#39;http://www.ewal.net/2011/12/31/upcoming-maintenance/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2011/12/new-feature-explore-past.html}, &#39;http://www.ewal.net/2011/12/09/new-feature-explore-the-past/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2011/12/better-looking-long-term-charts.html}, &#39;http://www.ewal.net/2011/12/01/better-looking-long-term-charts/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2011/11/technical-difficulties.html}, &#39;http://www.ewal.net/2011/11/30/technical-difficulties/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2011/11/new-feature-goal-bands.html}, &#39;http://www.ewal.net/2011/11/29/new-feature-goal-bands/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/2011/11/introducing-trendweight.html}, &#39;http://www.ewal.net/2011/11/07/introducing-trendweight/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 &#39;/feeds/posts/default&#39;, &#39;http://www.ewal.net/categories/trendweight/atom.xml&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{.*}, &#39;http://www.ewal.net/trendweight/&#39;, :host =&gt; &quot;blog.trendweight.com&quot;
  r301 %r{^/shazam.php}, &#39;https://sourceforge.net/projects/hmdj/&#39;
  r301 %r{^/hmdj-docs}, &#39;https://sourceforge.net/projects/hmdj/&#39;
  r301 %r{^/_shazam.aspx}, &#39;https://sourceforge.net/projects/hmdj/&#39;
  r301 %r{^/hmdj/}, &#39;https://sourceforge.net/projects/hmdj/&#39;
  r301 %r{^/PermaLink,guid,f314a8bc-4a97-4a77-b2de-c2771b77f222.aspx}, &#39;http://www.iis.net/download/urlrewrite&#39;
end

# other stuff appears here ...
</code></pre>
<h2 id="404-errors">404 Errors</h2>
<p>Because I didn&#39;t set up rewrite rules for every single URL that has ever been valid on Ewal.net, I wanted to make sure that there were appropriate 404 errors for pages that don&#39;t exist.  By default, Octopress has a 404 page that tells humans that a page they requested doesn&#39;t exist.  However, if you look at the actual HTTP traffic, you&#39;ll see that that page is returned with an HTTP 200 status.  This is a problem because it means that Google and other search engines that are following links will think these URLs are actual pages (that happen to have pointless content).  Besides cluttering up Google&#39;s index, that is also bad for my site ranking (which isn&#39;t that great to begin with and can&#39;t afford any dings against it) because Google will see lots of URLs with exactly the same content which they consider to be search engine spam.</p>
<p>The solution is to make Sinatra (the super lightweight ruby web application engine that serves up the static octopress files) return an actual 404 for these pages.  This requires using the (currently) unreleased version of Sinatra from GitHub because the feature we need isn&#39;t in the currently released version.  This isn&#39;t too hard to accomplish.  I replaced the existing Sinatra line in my Gemfile with the line below and then ran <code>bundle update</code> to update the installed gems.</p>
<pre><code>gem &#39;sinatra&#39;, :git =&gt; &quot;git://github.com/sinatra/sinatra.git&quot;
</code></pre><p>Then, in <code>./config.ru</code>, I updated the Sinatra code to return a 404 status for URLs that don&#39;t exist (line 8 below):</p>
<pre><code class="lang-ruby">class SinatraStaticServer &lt; Sinatra::Base  

  get(/.+/) do
    send_sinatra_file(request.path) {404}
  end

  not_found do
    send_file(File.join(File.dirname(__FILE__), &#39;public&#39;, &#39;404.html&#39;), {:status =&gt; 404})
  end

  def send_sinatra_file(path, &amp;missing_file_block)
    file_path = File.join(File.dirname(__FILE__), &#39;public&#39;,  path)
    file_path = File.join(file_path, &#39;index.html&#39;) unless file_path =~ /\.[a-z]+$/i  
    File.exist?(file_path) ? send_file(file_path) : missing_file_block.call
  end

end
</code></pre>
<h2 id="ping-services">Ping Services</h2>
<p>I added several rake tasks (in <code>./Rakefile</code>) that notify search engines and blog ping services about new content (inspired by <a href="https://gist.github.com/1709714">this gist</a>).  I call these with <code>rake notify</code> after I deploy new content.</p>
<pre><code class="lang-ruby">desc &#39;Ping pingomatic&#39;
task :pingomatic do
  begin
    require &#39;xmlrpc/client&#39;
    puts &#39;* Pinging ping-o-matic&#39;
    XMLRPC::Client.new(&#39;rpc.pingomatic.com&#39;, &#39;/&#39;).call(&#39;weblogUpdates.extendedPing&#39;, &#39;Ewal.net&#39; , &#39;http://www.ewal.net&#39;, &#39;http://www.ewal.net/atom.xml&#39;)
  rescue LoadError
    puts &#39;! Could not ping ping-o-matic, because XMLRPC::Client could not be found.&#39;
  end
end

desc &#39;Notify Google of the new sitemap&#39;
task :sitemapgoogle do
  begin
    require &#39;net/http&#39;
    require &#39;uri&#39;
    puts &#39;* Pinging Google about our sitemap&#39;
    Net::HTTP.get(&#39;www.google.com&#39;, &#39;/webmasters/tools/ping?sitemap=&#39; + URI.escape(&#39;http://www.ewal.net/sitemap.xml&#39;))
  rescue LoadError
    puts &#39;! Could not ping Google about our sitemap, because Net::HTTP or URI could not be found.&#39;
  end
end

desc &#39;Notify Bing of the new sitemap&#39;
task :sitemapbing do
  begin
    require &#39;net/http&#39;
    require &#39;uri&#39;
    puts &#39;* Pinging Bing about our sitemap&#39;
    Net::HTTP.get(&#39;www.bing.com&#39;, &#39;/webmaster/ping.aspx?siteMap=&#39; + URI.escape(&#39;http://www.ewal.net/sitemap.xml&#39;))
  rescue LoadError
    puts &#39;! Could not ping Bing about our sitemap, because Net::HTTP or URI could not be found.&#39;
  end
end

desc &quot;Notify various services about new content&quot;
task :notify =&gt; [:pingomatic, :sitemapgoogle, :sitemapbing] do
end
</code></pre>
<h2 id="heroku-deployment">Heroku Deployment</h2>
<p>Last but not least, although I have been experimenting with <a href="/2012/08/28/octopress-plus-windows-azure-web-sites/">Octopress on Azure</a>, I currently host this site on <a href="http://www.heroku.com/">Heroku</a>.  I don&#39;t use the deployment method discussed in the Octopress documentation, though.  Mostly because I don&#39;t want to have the generated files in ./public/ included in my git repository.  I use a modified version of the method described by <a href="http://joshuawood.net/how-to-deploy-jekyll-slash-octopress-to-heroku/">Joshua Wood</a>.</p>
<p>My minimal <code>/_heroku/Gemfile</code> has both Sinatra and Rake-Rewrite:</p>
<pre><code class="lang-ruby">source &quot;http://rubygems.org&quot;

gem &#39;sinatra&#39;, :git =&gt; &quot;git://github.com/sinatra/sinatra.git&quot;
gem &#39;rack-rewrite&#39;
</code></pre>
<p>I have a slightly modified rake task (in <code>./Rakefile</code>) which copies my config.ru file to the _heroku folder every time I deploy (line 5 below) in case I have added a new rewrite rule, etc:</p>
<pre><code class="lang-ruby">desc &quot;deploy basic rack app to heroku&quot;
multitask :heroku do
  puts &quot;## Deploying to Heroku &quot;
  (Dir[&quot;#{deploy_dir}/public/*&quot;]).each { |f| rm_rf(f) }
  system &quot;cp config.ru #{deploy_dir}/&quot;
  system &quot;cp -R #{public_dir}/* #{deploy_dir}/public&quot;
  puts &quot;\n## copying #{public_dir} to #{deploy_dir}/public&quot;
  cd &quot;#{deploy_dir}&quot; do
    system &quot;git add .&quot;
    system &quot;git add -u&quot;
    puts &quot;\n## Committing: Site updated at #{Time.now.utc}&quot;
    message = &quot;Site updated at #{Time.now.utc}&quot;
    system &quot;git commit -m &#39;#{message}&#39;&quot;
    puts &quot;\n## Pushing generated #{deploy_dir} website&quot;
    system &quot;git push heroku #{deploy_branch}&quot;
    puts &quot;\n## Heroku deploy complete&quot;
  end
end
</code></pre>
<p>Everything else is as described in <a href="http://joshuawood.net/how-to-deploy-jekyll-slash-octopress-to-heroku/">Joshua&#39;s Post</a>.  To deploy, I run these commands (usually via a shell script):</p>
<pre><code>rake rename_posts
rake generate
rake deploy
rake notify
</code></pre>
    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/octopress/'>Octopress</a>
    </div>
    
</article>

    <article id="post" class="post">
    <div class="post-date">Sep 3rd, 2012</div>
    
    <h1><a href='/2012/09/03/monitoring-energy-usage-for-fun-and-profit/'>Monitoring Energy Usage For Fun and Profit</a></h1>
    
    <div class="post-content">
        <p>About a month ago, I finally got my CurrentCost EnviR home energy monitor hooked up. Originally sold only in Europe, CurrentCost now is available in the U.S.  However, the websites are a little confusing.  The main website, <a href="http://currentcost.com">currentcost.com</a> is still mostly for European customers while U.S. customers can go to <a href="http://currentcost.net">currentcost.net</a> to obtain hardware and support.  I have no idea why they have split things like this because it is very confusing.  North American-style hardware is also available via <a href="http://amzn.com/B002J9IDSG?tag=ewalnet-20">Amazon</a> and is <a href="http://www.amazon.com/gp/prime/?tag=ewalnet-20">prime</a> eligible.</p>
<h2 id="installation-setup">Installation &amp; Setup</h2>
<p>I ordered a basic starter package, the usb data cable, and several individual appliance monitors.  All together, the components include:</p>
<ul>
<li>Two CT Clamps</li>
<li>Transmitter Unit</li>
<li>Receiver Unit</li>
<li>USB Data Cable</li>
<li>Four Individual Appliance Monitors</li>
</ul>
<p><img class="fancybox border" src="/stuff/currentcost-ct-clamp.jpg" width="180" title="CT Clamps" />
<img class="fancybox border" src="/stuff/currentcost-transmitter1.jpg" width="180" title="Transmitter" />
<img class="fancybox border " src="/stuff/currentcost-receiver.jpg" width="180" title="Receiver" />
<img class="fancybox border" src="/stuff/currentcost-iam2.jpg" width="180" title="Individual Appliance Monitor" /></p>
<p>The CT Clamps are installed inside my electrical panel / breaker box. Doing this required opening the cover of the electrical panel.  Although the installation is very easy (the clamps just clip around the two main power feeds entering the box from the outside of the home), I decided to have an electrician install them.  We had an electrician here for another job and installing these clamps took him only about 30 seconds. He attached the clamps inside the electrical box an then fed the two cables out a small hole in the side of the box.</p>
<p>I mounted the transmitter (the black box in the photo above) to the wall next to the electrical panel and attached the two cables from the clamps.  The transmitter is powered by several &quot;D&quot; batteries that supposedly will last 7 years.  I decided to attach the transmitter with a screw in the wall instead of the included adhesive patch so that it would be easier to remove from the wall to replace the batteries as needed.  The transmitter reads the current power usage and sends it wirelessly to the receiver which can be up to 100 feet away.</p>
<p>The receiver sits on my desk in my office one floor up from the electrical panel.  You can see the display in the photo above.  It gives you some general real time information about your energy usage, but to get full value from this system, I connect the receiver to my Windows box with a USB data cable (sold separately) and send the data to a couple different online sites.  More on that later.</p>
<p>Finally, I also have 4 individual appliance monitors (IAMs).  These are like <a href="http://amzn.com/B000RGF29Q?tag=ewalnet-20">Kill A Watt</a> power monitors except they transmit their data to the central CurrentCost receiver.  During initial setup, each IAM had to be paired with the receiver, but that was relatively painless.  I have a lot of computers in my house and decided to get enough IAMs to monitor each set of computers.  In theory, the system can have up to 9 of these IAMs at the same time.  I plugged a power strip into each IAM.  I have my office computers on one, my servers on another (NAS, router, etc), and my two bitcoin mining rigs on the last two IAMs.</p>
<h2 id="understanding-the-data">Understanding the Data</h2>
<p>I send the data from my CurrentCost system to two separate websites: <a href="http://plotwatt.com">PlotWatt</a> and <a href="http://cosm.com">Cosm</a>.  Each is useful for different reasons.  I&#39;ll write a separate blog post later explaining how I get the data to each website (I am not using the &quot;web bridge&quot; device that is available from CurrentCost), but for now, let me just summarize what I think each is good for.</p>
<p><img src="/stuff/currentcost-cosm-console.png" title="Cosm Dashboard" />
<img src="/stuff/currentcost-plotwatt-cost.png" title="PlotWatt Dashboard" /></p>
<p>I like Cosm for the ability to quickly go to <a href="https://cosm.com/feeds/71541">my dashboard</a> and see what has been going on recently.  Cosm also makes all my historical data available via JSON and XML APIs, so if I ever wanted to create my own dashboard or analysis tool, I could use them as the backend database.</p>
<p>On the other hand, PlotWatt&#39;s mission is to give me an understanding of the cost of the energy I am using.  They analyze the patterns of energy use and over time will be able to tell me how much my refrigerator or A/C is costing me (see their <a href="https://plotwatt.com/users/demo_login">demo dashboard</a>).  PlotWatt knows what rates my utility company charge, and they convert my electrical usage to an estimate of my next bill.  I can also set budgets for the whole house or an individual appliance and then get notifications when I go over budget.</p>
<p>I&#39;ll admit that my inability to resist a cool gadget was probably the real reason I bought this system in the first place.  That said, it has shed some light on how much my computers cost me (and how much my <a href="http://bitcoin.org/">bitcoin</a> hobby costs me, in particular).  And sometimes there are interesting patterns in the data.  For example, the graph below is the energy usage for my Synology NAS:</p>
<p><img class="fancybox" src="/stuff/currentcost-plotwatt-timemachine-blips.png" width="800" title="Effect of TimeMachine on NAS" /></p>
<p>You&#39;ll notice that once an hour, there is a small increase in power usage for the NAS. This is TimeMachine on my Mac Mini doing its hourly backup.  Pretty cool.</p>
<p><br class="clear" /></p>

    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/gadgets/'>Gadgets</a>, <a href='/tags/currentcost/'>CurrentCost</a>, <a href='/tags/plotwatt/'>PlotWatt</a>, <a href='/tags/cosm/'>Cosm</a>
    </div>
    
</article>

    <article id="post" class="post">
    <div class="post-date">Aug 29th, 2012</div>
    
    <h1><a href='/2012/08/29/whats-next-for-trendweight/'>What's Next for TrendWeight?</a></h1>
    
    <div class="post-content">
        <p>Glad you asked.  I have two features I have on my short list of features I&#39;d like to work on next.</p>
<h2 id="i-don-t-go-to-sleep-at-midnight-">I don&#39;t go to sleep at midnight...</h2>
<p>As you may have discovered, TrendWeight uses the first weigh-in of each day in its calculations and ignores the rest.  I&#39;d like to better support those of you that stay up past midnight and would like to be able to weigh yourself before you go to bed without throwing off the stats.  I&#39;ll be adding a setting where you can choose an alternative time of day (other than midnight) that TrendWeight will use when deciding which is the first weigh-in of the day.  For example, if you routinely stay up until 1 or 2am, you might choose 4am as the start of a new day.</p>
<h2 id="am-i-gaining-weight-because-i-m-building-muscle-">Am I gaining weight because I&#39;m building muscle?</h2>
<p>Many have requested support for tracking body fat % in the same way that total body weight can currently be tracked (exponential moving averages, etc).  This is a larger project, and will take longer. I am not entirely sure how I&#39;ll end up approaching this, but it is on my short list to get done some time this fall.</p>
<p>My initial thought is to allow you to view the stats and charts in terms of total body weight, body fat, or lean mass.  This way you&#39;ll be able to see if the amount of fat in your body is going up or down regardless of if your lean mass is changing.  It remains to be seen how chaotic that data will be.  My experience is that the body fat % reported by both the Withings and FitBit scales are significantly less precise than the weights.  This may mean the charts are much more erratic unless the data is analyzed differently.  Or maybe the charts will be more erratic but still a useful way to gain some insight into what&#39;s happening with your body.</p>
<p>I don&#39;t have John Walker&#39;s guidance to rely on this time (he was the author of The Hacker&#39;s Diet and his analysis techniques were the inspiration for TrendWeight).  If you have strong feelings about the &quot;right way&quot; to analyze body fat %, total body fat (in lbs/kg), or lean mass (in lbs/kg) over time, please email me at <a href="&#x6d;&#97;&#105;&#x6c;&#116;&#111;&#58;&#x73;&#x75;&#x70;&#112;&#x6f;&#x72;&#x74;&#x40;&#116;&#114;&#101;&#x6e;&#100;&#x77;&#x65;&#105;&#x67;&#104;&#x74;&#x2e;&#x63;&#x6f;&#109;">&#x73;&#x75;&#x70;&#112;&#x6f;&#x72;&#x74;&#x40;&#116;&#114;&#101;&#x6e;&#100;&#x77;&#x65;&#105;&#x67;&#104;&#x74;&#x2e;&#x63;&#x6f;&#109;</a>.</p>
<p><em>P.S. The blog moved. If you&#39;ve been using TrendWeight for a while, you probably noticed that the blog looks different.  I&#39;ve decided to incorporate the TrendWeight blog posts into my personal blog instead of maintaining two blog websites.  You probably don&#39;t care about the non-TrendWeight blog posts, though.  No problem! If you just want to see the TrendWeight related stuff, you can continue to go to <a href="http://blog.trendweight.com">blog.trendweight.com</a> and you&#39;ll end up on a page that just has the TrendWeight-related posts.</em></p>

    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/trendweight/'>TrendWeight</a>
    </div>
    
</article>

    <article id="post" class="post">
    <div class="post-date">Aug 28th, 2012</div>
    
    <h1><a href='/2012/08/28/octopress-plus-windows-azure-web-sites/'>Octopress + Windows Azure Web Sites</a></h1>
    
    <div class="post-content">
        <h2 id="why-">Why?</h2>
<p>Why not!  I&#39;m a fan of Azure and wanted to see if it would work well with their git publishing.  It turns out that publishing to an Azure Web Site via git is pretty much like publishing to Github Pages.</p>
<h2 id="how-">How?</h2>
<p>The built in <code>rake setup_github_pages</code> won&#39;t work, so you&#39;ll have to do what would have done manually, but that&#39;s not too hard.</p>
<p>First, while in the top level folder for your octopress blog, run this command to rename the existing origin repository (the place you got octopress from when you cloned it):</p>
<pre><code class="lang-none">git remote rename origin octopress
</code></pre>
<p>Then create and initialize the deployment directory for your Azure Web Site, and do an initial push:</p>
<pre><code class="lang-none">mkdir _azure
cd _azure
git init .
echo &quot;Hello, World!&quot; &gt; index.html
git add .
git commit -m &quot;initial commit&quot;
git remote add origin https://yourusername@yoursite.scm.azurewebsites.net/yoursite.git
git push origin master
</code></pre>
<p>Of course, replace <code>yourusername</code> and <code>yoursite</code> appropriately. This should prompt you for your the git username/password you setup on the Azure site and publish your empty site.  If you go to your site, you should see &quot;Hello, World!&quot;</p>
<p>Last edit, the Rakefile and make sure you set these three variables (they are each near the top)</p>
<pre><code class="lang-ruby">deploy_default = &quot;push&quot;
deploy_branch = &quot;master&quot;
deploy_dir = &quot;_azure&quot;
</code></pre>
<p>Lastly, in _config.yml, make sure that the url variable is set to your site&#39;s url.</p>
<p>That&#39;s it.  Now, you can publish your site by running <code>rake deploy</code> or <code>rake gen_deploy</code>.</p>

    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/azure/'>Azure</a>, <a href='/tags/octopress/'>Octopress</a>
    </div>
    
</article>

    <article id="post" class="post">
    <div class="post-date">Aug 20th, 2012</div>
    
    <h1><a href='/2012/08/20/new-feature-1-kg-equals-2-dot-20462-lb/'>New Feature: 1 kg = 2.20462 lb</a></h1>
    
    <div class="post-content">
        <p>TrendWeight now supports those of you in enlightened countries that use the metric system and use kilograms as their primary unit of weight.</p>
<p>In all seriousness, given that more than 20% of active TrendWeight accounts are users outside of the United States, I feel bad that it took me this long to get the changes made.  Please accept my apologies for the long wait.</p>
<p>To enable this for your account, go to your settings page and change the weight units from &#39;lbs&#39; to &#39;kg&#39;.  Note, double check your Goal Weight after you make the change.  It should automatically be converted to a roughly equivalent weight in kg, but you may want to adjust it up or down by 1 kg if you don&#39;t like how I did the rounding.</p>
<p><img class="fancybox" src="/stuff/trendweight-metric.png" /></p>
<p>A word of warning though: this functionality is hot off the presses, and while I did some testing (and a couple others volunteered to help me out as well), I won&#39;t be satisfied that it works flawlessly until a few weeks go by with lots of you using kg for your unit of choice.  So...  If you see anything odd (places where the UI still is referring to lbs or places where the numbers seem fishy), please email me at support@trendweight.com and I&#39;ll try to figure out what is wrong.</p>

    </div>
    
    <div class="post-tags">
        Posted In: <a href='/tags/trendweight/'>TrendWeight</a>
    </div>
    
</article>


<div class="page-nav">
    
    <a class="page-nav-older" href="/page/8/"><span class="icon icon-arrow-left-2"></span> Older</a>
    
    
    <a class="page-nav-newer" href="/page/6/">Newer <span class="icon icon-arrow-right-2"></span></a>
    
    <div class="page-nav-archives"><a href="/archives/">- Blog Archives -</a></div>
</div>

<div id="me">
    <p>
        <img src="http://en.gravatar.com/avatar/5fcc0f8df1923f433513b0f731c99402?s=100" alt="Erv Walter" />
        I'm <b>Erv Walter</b>, a software developer, a computer geek, and a board game addict living in Sun Prairie, Wisconsin.  My interests include Azure, ASP.NET, Node.js, AngularJS, Knockout, and web development in general. And I'm a sucker for any kind of gadget.
    </p>
    <p>
        <a href="http://twitter.com/ervwalter">@ErvWalter</a> &#8226;
        <a href="https://github.com/ervwalter">GitHub</a> &#8226;
        <a href="mailto:erv@ewal.net">Email Me</a>
    </p>
</div>

        </div>
    </div>
</div>
<div class="container">
    <div class="navbar navbar-footer">
        <p class="navbar-center navbar-text">Copyright &copy; 2011-2013 Erv Walter</p>
    </div>
</div>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="/scripts/vendor/highlight.pack.js?1419397389559"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.6.3/coffee-script.min.js"></script>
<script src="/scripts/site.js?1419397389559"></script>



<script type="text/javascript">
	var $buoop = {
		url: 'http://whatbrowser.org/',
        reminder: 0,
		newwindow: false,
		'text': 'You are using an outdated browser (%s). <a%s>More information &#187;</a>',
		'text_af': 'Jy gebruik \'n verouderde webblaaier (%s). <a%s>Meer inligting &#187;</a>',
		'text_cs': 'Používáte zastaralý prohlížeč (%s). <a%s>Více informací &#187;</a>',
		'text_da': 'Du bruger en ældre browser (%s). <a%s>Mere information &#187;</a>',
		'text_de': 'Sie benutzen einen veralteten Browser (%s). <a%s>Mehr Informationen &#187;</a>',
		'text_el': 'Χρησιμοποιείτε ένα ξεπερασμένο πρόγραμμα περιήγησης. <a%s>Περισσότερες πληροφορίες &#187;</a>',
		'text_es': 'Su navegador está obsoleto (%s). <a%s>M&aacute;s informaci&oacute;n &#187;</a>',
		'text_fi': 'Käytät vanhentunutta selainta (%s). <a%s>Lisää tietoa &#187;</a>',
		'text_fr': 'Votre navigateur n\'est pas à jour (%s). <a%s>Plus d\'information &#187;</a>',
		'text_hu': 'A böngészője elavult (%s). <a%s>További információ &#187;</a>',
		'text_id': 'Anda menggunakan web browser versi lama (%s). <a%s>Informasi selengkapnya &#187;</a>',
		'text_is': 'Þú ert að nota úreltan vafra (%s). <a%s>Nánari upplýsingar &#187;</a>',
		'text_it': 'Stai usando un browser datato (%s). <a%s>Ulteriori informazioni &#187;</a>',
		'text_nl': 'U gebruikt op dit moment een verouderde webbrowser (%s). <a%s>Meer informatie &#187;</a>',
		'text_pl': 'Używasz przestarzałej przeglądarki (%s). <a%s>Więcej informacji &#187;</a>',
		'text_pt': 'Você está usando um navegador antigo (%s). <a%s>Mais informações &#187;</a>',
		'text_ro': 'Browserul dumneavoastră este depăşit (%s). <a%s>Mai multe informații &#187;</a>',
		'text_ru': 'Вы используете устаревший браузер (%s). <a%s>Подробнее &#187;</a>',
		'text_sk': 'Používate zastaralý prehliadač (%s). <a%s>Viac informácií &#187;</a>',
		'text_sr': 'Vi koristite zastarelu verziju browsera (%s). <a%s>Vi&#353;e informacija &#187;</a>',
		'text_sv': 'Du använder en gammal webbläsare (%s). <a%s>Mer information &#187;</a>',
		'text_tr': 'Çok eski bir tarayıcı kullanıyorsunuz (%s). <a%s>Daha fazla bilgi &#187;</a>',
		'text_vi': 'Trình duyệt bạn dùng đã lỗi thời rồi (%s). <a%s>Thêm thông tin &#187;</a>'
	};
	$buoop.ol = window.onload;
	window.onload=function(){
		try {if ($buoop.ol) $buoop.ol();}catch (e) {}
		var e = document.createElement("script");
		e.setAttribute("type", "text/javascript");
		e.setAttribute("src", "//browser-update.org/update.js");
		document.body.appendChild(e);
	}
</script>

</body>
</html>